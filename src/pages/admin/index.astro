---
import Layout from "@/layouts/Layout.astro";
import { AdminDashboard } from "@/components/AdminDashboard";

export const prerender = false;

// Check authentication
const { user } = Astro.locals;

if (!user) {
  return Astro.redirect("/login?redirect=/admin");
}

// Check admin role
const { data: userData, error: userError } = await Astro.locals.supabase
  .from("users")
  .select("role, email")
  .eq("id", user.id)
  .single();

if (userError || !userData || userData.role !== "admin") {
  return Astro.redirect("/?error=unauthorized");
}
---

<Layout title="Admin Dashboard" showNavigation={true}>
  <div class="min-h-screen bg-neutral-50 dark:bg-neutral-950">
    <div class="container mx-auto px-4 py-8 md:py-12">
      <div class="max-w-7xl mx-auto">
        <!-- Header -->
        <div class="mb-8">
          <div class="flex items-center justify-between">
            <div>
              <h1 class="text-3xl font-bold text-neutral-900 dark:text-neutral-100">Admin Dashboard</h1>
              <p class="text-neutral-600 dark:text-neutral-400 mt-2">
                Welcome back, {userData.email}
              </p>
            </div>
            <div class="flex gap-2">
              <a
                href="/"
                class="inline-flex items-center justify-center rounded-md bg-neutral-100 dark:bg-neutral-800 px-4 py-2 text-sm font-medium text-neutral-900 dark:text-neutral-100 hover:bg-neutral-200 dark:hover:bg-neutral-700 transition-colors"
              >
                View Site
              </a>
            </div>
          </div>
        </div>

        <!-- Dashboard Content -->
        <AdminDashboard client:load />
      </div>
    </div>
  </div>
</Layout>
